# $2.11BSD_X44: Makefile,v 1.0 2026/01/20 19:16:45 martin Exp $

# TODO: (in no set order)
# - Compile manpages
# - Compile contents of tcsh/nls subdir
# - Fix remaining compile issues

.include <bsd.own.mk>

.include "${.CURDIR}/../Makefile.inc"

PROG=       tcsh

SH_SRCS=	sh.c sh.dir.c sh.dol.c sh.err.c sh.exec.c \
	        sh.char.c sh.exp.c sh.file.c sh.func.c \
        	sh.glob.c sh.hist.c sh.init.c sh.lex.c \
	        sh.misc.c sh.parse.c sh.print.c sh.proc.c \
	        sh.sem.c sh.set.c sh.time.c glob.c mi.termios.c \
            ma.setp.c

TWO_SRCS=	tw.help.c tw.init.c tw.parse.c tw.spell.c \
	        tw.comp.c tw.color.c

ED_SRCS=	ed.chared.c ed.refresh.c ed.screen.c ed.init.c \
	        ed.inputl.c ed.defns.c ed.xmap.c ed.term.c

TC_SRCS=	tc.alloc.c tc.bind.c tc.const.c tc.disc.c \
	        tc.func.c tc.nls.c tc.os.c tc.printf.c \
        	tc.prompt.c tc.sched.c tc.sig.c tc.str.c \
        	tc.vers.c tc.who.c

SRCS+=	    dotlock.c dotlock.h

GENSRCS=    tc.defs.c
GENHDRS=    ed.defns.h sh.err.h tc.const.h

SRCS+=      ${SH_SRCS} ${TWO_SRCS} ${ED_SRCS} ${TC_SRCS}
SRCS+=      ${GENHDRS} ${GENSRCS}

.if defined(RESCUE)
DFLAGS=     -D_PATH_TCSHELL='"/rescue/${PROG}"'
.else
DFLAGS=     -D_PATH_TCSHELL='"/bin/${PROG}"'
.endif

CPPFLAGS+= -I. -I${.CURDIR} ${DFLAGS}
CPPFLAGS+= -D__ICONV_COMPAT
CPPFLAGS+= -I${TCSHDIST}
CPPFLAGS+= -I${TCSHINC}

.PATH:      ${TCSHDIST}
.PATH:      ${TCSHINC}

DPADD=	    ${LIBCURSES} ${LIBCRYPT} ${LIBCRYPTO} ${LIBTERMCAP}
LDADD=	    -lcurses -lcrypt -lcrypto -ltermcap

tc.defs.c: ${TOOL_GETHOST} ${TCSHDIST}/host.defs
	${_MKTARGET_CREATE}
	rm -f ${.TARGET}
	echo "/* Do not edit this file, make creates it */" > ${.TARGET}
	${TOOL_GETHOST} ${TCSHDIST}/host.defs >> ${.TARGET}

ed.defns.h: ed.defns.c
	${_MKTARGET_CREATE}
	rm -f ${.TARGET}
	echo '/* Do not edit this file, make creates it. */' > ${.TARGET}
	echo '#ifndef _h_ed_defns' >> ${.TARGET}
	echo '#define _h_ed_defns' >> ${.TARGET}
	egrep '[FV]_' ${TCSHDIST}/ed.defns.c | egrep '^#define' >> ${.TARGET}
	echo '#endif /* _h_ed_defns */' >> ${.TARGET}

sh.err.h: sh.err.c
	${_MKTARGET_CREATE}
	rm -f ${.TARGET}
	echo '/* Do not edit this file, make creates it. */' > ${.TARGET}
	echo '#ifndef _h_sh_err' >> ${.TARGET}
	echo '#define _h_sh_err' >> ${.TARGET}
	egrep 'ERR_' ${.ALLSRC} | egrep '^#define' >> ${.TARGET}
	echo '#endif /* _h_sh_err */' >> ${.TARGET}

tc.const.h: tc.const.c sh.char.h config.h config_f.h sh.types.h sh.err.h
	${_MKTARGET_CREATE}
	rm -f ${.TARGET}
	echo '/* Do not edit this file, make creates it. */' > ${.TARGET}
	echo '#ifndef _h_tc_const' >> ${.TARGET}
	echo '#define _h_tc_const' >> ${.TARGET}
	${CC} -E ${CPPFLAGS} ${.ALLSRC} -D_h_tc_const | egrep 'Char STR' | \
	    ${TOOL_SED} -e 's/Char \([a-zA-Z0-9_]*\)\(.*\)/extern Char \1[];/' | \
	    sort >> ${.TARGET}
	echo '#endif /* _h_tc_const */' >> ${.TARGET}

COPTS.dotlock.c+= -Wno-unused-but-set-variable
COPTS.ed.screen.c+= -Wno-format-nonliteral
COPTS.ed.xmap.c+= -Wno-format-nonliteral
COPTS.sh.c+= -Wno-format-nonliteral
COPTS.sh.dir.c+= -Wno-format-nonliteral
COPTS.sh.exec.c+= -Wno-format-nonliteral
COPTS.sh.func.c+= -Wno-format-nonliteral
COPTS.sh.lex.c+= -Wno-format-nonliteral
COPTS.sh.proc.c+= -Wno-format-nonliteral
COPTS.sh.sem.c+= -Wno-format-nonliteral
COPTS.tc.alloc.c+= -Wno-format-nonliteral
COPTS.tc.bind.c+= -Wno-format-nonliteral
COPTS.tc.func.c+= -Wno-format-nonliteral
COPTS.tc.who.c+= -Wno-format-nonliteral
COPTS.tw.help.c+= -Wno-format-nonliteral
COPTS.tw.parse.c+= -Wno-format-nonliteral

.include <bsd.prog.mk>
